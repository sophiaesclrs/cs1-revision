<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="https://flag-icon-css.lip.is/css/flag-icon.min.css"> -->


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <link href="https://cdn.datatables.net/v/bs5/jq-3.6.0/dt-1.13.4/datatables.min.css" rel="stylesheet"/>

    
  <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
  <script src="https://cdn.datatables.net/v/bs5/jq-3.6.0/dt-1.13.4/datatables.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>


    <link rel="stylesheet" href="css/datasets.css">
    <title>ITD108</title>
    <script defer src="./bundle.js"></script>

    <style>
      @import url('https://fonts.googleapis.com/css2?family=Raleway&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Poppins&display=swap');

      :root{--blue:#006994;}

      body{
        margin: 0px;
        padding: 0px;
        background: #A9D1D4;
        font-family: 'Raleway', sans-serif;
      }

      img {
        height: 100%;
        width: 100%;
        object-fit: cover;
      }
      .clearfix{
        clear: both;
      }

      .sidenav .logo{ 
        margin: 0;
        color: black;
        margin-left: 28px;
        font-weight: bolder;
        padding: 0.7rem 1%;
        margin-bottom: 40px;
        font-size: 30px;
      }
      .sidenav .logo span{
        font-family: Georgia, 'Times New Roman', Times, serif;
        color: var(--blue);
      }

      .sidenav{
        background: white;
        backdrop-filter: blur(15px);
        padding-top: 30px;
        width: 300px;
        height: 100vh;
        position: fixed;
        top: 0;
        left: 0%;
        overflow: hidden;
        transition: 0.3s ease;
        transition-property: left;
        border-top-right-radius: 10px;
        border-bottom-right-radius: 10px;
        white-space: nowrap;
        z-index: 1;
      }
      .sidenav a{
        font-family: 'Poppins', sans-serif;
        position: relative;
        font-weight: bold;
        padding: 20px 8px 15px 32px;
        text-decoration: none;
        font-size: 17px;
        color: black;
        display: block;
        transition: 0.5s ease;
      }
      .sidenav a.active{
        display: block;
        background: #A9D1D4;
      }

      .signout a{
        margin-top: 100%;
      }
      .sidenav a:hover{
        background: #A9D1D4;
        border-radius: 3%;
      }
      .sidenav i{
        margin-right: 15px;
        width: 15px;
      }

      #main{
        padding: 16px;
        margin-left: 300px;
      }
      .head{
        padding: 20px;
      }

      .col-div-6{
        width: 50%;
        float: left;
      }

      .profile{
        cursor: pointer;
        font-family: 'Poppins', sans-serif;
        display: inline-block;
        float: right;
        width: 160px;
      }
      .pro-img{
        float: right;
        width: 40px; 
        margin: 0px;
      }

      /*table*/

      .report-header{
        width: 94%;
        padding: 1rem;
      }

      .report{
        margin: 10px;
        height: 506px;
        box-shadow: 0px 0px 18px 0 #0000002c;
        border-radius: 0.3rem;
        background: whitesmoke;
        overflow: auto;
      }
      .report::-webkit-scrollbar{
        width: 0.3rem;
        height: 0.3rem;
      }
      .report::-webkit-scrollbar-thumb{
        border-radius: 0.5rem;
        background-color: black;
        visibility: hidden;
      }
      .report:hover::-webkit-scrollbar-thumb{
        visibility: visible;
      }

      .add{
        justify-content: space-between;
        display: flex;
        align-items: left;
      }
      .add span{
        margin: 0;
        font-size: 1.3rem;
        font-weight: bold;
      }
      .add a i{
        position: relative;
        float: right;
        font-size: 2rem;
        transition: 0.5s ease;
      }

      table{
        width: 100%;
      }
      table, td, th{
        border-collapse: collapse;
        transition: 0.5s ease;
        text-align: left;
        padding: 1rem;
      }

      thead th{
        font-size: 0.8rem;
        position: relative;
        top: 0;
        left: 0;
        background-color: #0000000b;
      }

      thead th:first-child{
        padding-left: 1rem;
      }
      tbody td:first-child{
        padding: 1rem 0rem;
        padding-left: 1rem;
        color: #012169;
        font-weight: bold;
        font-size: 0.7rem;
      }

      tbody td{
        color: black;
        font-size: 0.7rem;
        font-weight: bold;
      }

      .country{
        margin-right: 0.5rem;
      }
      .country-img{
        display: flex;
        align-items: center;
      }
      .country-name{
        font-size: 0.7rem;
        font-weight: bold;
      }

      td img{
        width: 40px;
        height: 40px;
        margin-right: 1.5rem;
        border-radius: 50%;
        vertical-align: middle;
      }
      
      .actions{
        position: relative;
        cursor: pointer;
        display: inline-block;
        font-size: 1.2rem;
        margin-top: 1rem;
        margin-left: 0.3rem;
        margin-right: 0.5rem;
        transition: 0.5s ease;
      }

      tbody tr{
        transition: 0.5s ease;
      }
      tbody tr:nth-child(even){
        background-color: #0000000b;
      }
      tbody tr:hover{
        transform: scale(1.0);
        box-shadow: 2px 2px 12px rgba(0, 0, 0, 0.2), -1px -1px 8px rgba(0, 0, 0, 0.2);
      }

      /*modal*/
      .modal, .modal-dialog, .modal-content, .modal-header, .modal-title, .modal-body, .modal-footer{
        font-family: 'Poppins', sans-serif;
        font-size: 0.8rem;
        font-weight: bold;
      }

      .col-sm-7 input{
        font-family: 'Raleway', sans-serif;
        font-weight: bold;
      }

      .modal-footer button{
        padding: 0.5rem;
      }

      .modal .modal-footer .cancel{
        font-size: 0.9rem;
        background: none;
        border: 1px solid #7c0a02;
        color: black;
        border-radius: 5px;
        transition: 0.5s ease;
      }
      .modal .modal-footer .cancel:hover{
        background: #7c0a02;
        color: whitesmoke;
      }
      .modal .modal-footer .create{
        font-size: 0.9rem;
        background: none;
        border: 1px solid #012169;
        color: black;
        border-radius: 5px;
        transition: 0.5s ease;
      }
      .modal .modal-footer .create:hover{
        background: #012169;
        color: whitesmoke;
      }

      .modal .modal-footer .update{
        font-size: 0.9rem;
        background: none;
        border: 1px solid #0B6623;
        color: black;
        border-radius: 5px;
        transition: 0.5s ease;
      }
      .modal .modal-footer .update:hover{
        background: #0B6623;
        color: whitesmoke;
      }
    </style>
</head>

<body>
  
  <div id="sidenav" class="sidenav">

    <p class="logo">codata<span>.</span></p>

    <a href="home.html" class="icon-a"><i class="fa-solid fa-list-check"></i> &nbsp;&nbsp; Dashboard</a>

    <a href="datasets.html" class="active"><i class="fa-solid fa-database icons"></i> &nbsp;&nbsp; Datasets</a>

    <a href="visual.html"class="icon-a"><i class="fa-solid fa-chart-simple icons"></i> &nbsp;&nbsp; Data Visualization</a>

    <div class="signout">
      <a href="#"class="icon-a"><i class="fa-solid fa-right-from-bracket icons"></i> &nbsp;&nbsp; Sign Out</a>
    </div>
    
  </div>

  <div id="main">
    <div class="head">

      <div class="col-div-6">
        <span  id="overview" style="font-size: 35px; cursor: pointer; font-weight: bold;" > Datasets </span>
      </div>

      <div class="col-div-6">
        <div class="profile">

          <img src="https://img.icons8.com/external-tanah-basah-glyph-tanah-basah/48/1A1A1A/external-user-user-tanah-basah-glyph-tanah-basah-4.png" class="pro-img"/>

        </div>
      </div>

      <div class="clearfix"></div>
    </div>

    <div class="clearfix"></div>
	  <br>

        <div class="report">

          <div class="report-header">

            <div class="add">
              <span>Global COVID-19 Cases Report</span><a href="#" data-bs-toggle="modal" data-bs-target="#addData" onclick="AddData()">
                <i class="fa-solid fa-square-plus" style="color: #012169;"></i>
              </a>
            </div>
    
          </div>
    
          <!--add data starts-->
     
          <div class="modal fade"  id="addData" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Add New COVID-19 Cases</h5>
                  <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
    
                <form action="javascript:void();" method="POST" id="addNewData">
                  <div class="modal-body" >
    
                    <div class="mb-3 row">
                      <label for="inputCountry" class="col-sm-4 col-form-label">Country</label>
                      <div class="col-sm-7">
                        <input type="text" class="form-control" id="countryAdd" name="inputCountry">
                      </div>
                    </div>
    
                    <div class="mb-3 row">
                      <label for="inputRegion" class="col-sm-4 col-form-label">WHO Region</label>
                      <div class="col-sm-7">
                        <input type="text" class="form-control" id="regAdd" name="inputRegion">
                      </div>
                    </div>
    
                    <div class="mb-3 row">
                      <label for="inputCTotal" class="col-sm-4 col-form-label">Cumulative Total</label>
                      <div class="col-sm-7">
                        <input type="number" class="form-control" id="caseAdd" name="inputCTotal">
                      </div>
                    </div>
                    
                    <div class="mb-3 row">
                      <label for="inputDTotal" class="col-sm-4 col-form-label">Total Deaths</label>
                      <div class="col-sm-7">
                        <input type="number" class="form-control" id="deathAdd" name="inputDTotal">
                      </div>
                    </div>
                  </div>
    
                  <div class="modal-footer">
                    <button type="button" class="cancel" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" id = "addButton" class="create" >Add Data</button>
                  </div>
                </form>
              </div>
            </div>
          </div>
    
        <!--add data ends-->

          <div>
              <table>

                <thead>
                  <tr>
                    <th>No.</th>
                    <th>Country</th>
                    <th>WHO Region</th>
                    <th>Cumulative Total</th>
                    <th>Death Cumulative Total</th>
                    <th>Actions</th>
                  </tr>
                </thead>

                <tbody id="tbody1"></tbody>

              </table>
            </div>
        </div>
    
    <div class="clearfix"></div>
  </div>

  <!--update data starts-->

    <div class="modal fade" id="staticBackdrop1" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Update Data Report</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>

            <div class="modal-body">

              <input type="hidden" id="id" name="id" value="">
              <input type="hidden" id="trid" name="trid" value="">

              <div class="mb-3 row">
                <label for="inputCountry" class="col-sm-4 col-form-label">Country</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" id="countryEd" name="_inputCountry">
                </div>
              </div>

              <div class="mb-3 row">
                <label for="inputRegion" class="col-sm-4 col-form-label">WHO Region</label>
                <div class="col-sm-7">
                  <input type="text" class="form-control" id="regEd" name="_inputRegion">
                </div>
              </div>

              <div class="mb-3 row">
                <label for="inputCTotal" class="col-sm-4 col-form-label">Cumulative Total</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="caseEd" name="_inputCTotal">
                </div>
              </div>
              
              <div class="mb-3 row">
                <label for="inputDTotal" class="col-sm-4 col-form-label">Total Deaths</label>
                <div class="col-sm-7">
                  <input type="number" class="form-control" id="deathEd" name="_inputDTotal">
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="button" class="cancel" data-bs-dismiss="modal">Cancel</button>
              <button type="submit" id = "edButton" class="update">Save Changes</button>
            </div>
        </div>
      </div>
    </div>
  <!--update data ends-->


  <!-- Ig magdelete data  CAUTION -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Pagsure</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <!-- <form action="" method="POST" id="editNewData"> -->
        <!-- <form action="javascript:void();" method="POST" id="editNewData"> -->
        <div class="modal-body">
          <h4>Suree?</h4>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" id="delButton" class="update">Yes</button>
        </div>
      <!-- </form> -->
      </div>
    </div>
  </div>
  <!--delete data ends-->
</body>
</html>


 <script type="module">
   
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
import { getFirestore, setDoc, addDoc, doc, updateDoc,deleteDoc, getDoc, query, collection, where, getDocs, onSnapshot  } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";



const firebaseConfig = {
    apiKey: "AIzaSyBHy3Gihw8S_mt9_DfJtig77IDzqs5mamA",
    authDomain: "casestudy1-dc7ed.firebaseapp.com",
    projectId: "casestudy1-dc7ed",
    storageBucket: "casestudy1-dc7ed.appspot.com",
    messagingSenderId: "795551283591",
    appId: "1:795551283591:web:c8721a89279c5629137b22",
    measurementId: "G-9QM42NYXW1"
  };

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
console.log(app);


// ---------------------------------Add Data -------------------------//

window.AddData = function(){
  const AddBtn = document.querySelector("#addButton")
  AddBtn.addEventListener("click", async () =>{
  try {
    const collectionRef = collection(db, "covid")
    const newUser = await addDoc(collectionRef,{

      country: document.getElementById("countryAdd").value,
      who_reg: document.getElementById("regAdd").value,
      cases: document.getElementById("caseAdd").value,
      death: document.getElementById("deathAdd").value,
      //$('#addData').modal('hide');

    })
      console.log(`Create new user: ${newUser.id}`)
      const addDataModal = document.getElementById('addData');
      const modal = bootstrap.Modal.getInstance(addDataModal);
      modal.hide();
    } catch (error) { console.log(error) }
  }
)};

//------------------------------------Get Data------------------------------------------//
var dataNo =0;
var datasets = [];
var tbody = document.getElementById('tbody1');


function AddItemToTable(country, who_reg, cases, death, id){
  var trow = document.createElement('tr');
  // var td0 = document.createElement('td'); 
  var td1 = document.createElement('td');
  var td2 = document.createElement('td');
  var td3 = document.createElement('td');
  var td4 = document.createElement('td');
  var td5 = document.createElement('td');

  // td0.innerHTML = ''; 
  td1.innerHTML = ++dataNo;
  td2.innerHTML = country;
  td3.innerHTML = who_reg;
  td4.innerHTML = cases;
  td5.innerHTML = death;
  datasets.push([country, who_reg, cases, death, id]);

  // trow.appendChild(td0); 
  trow.appendChild(td1);
  trow.appendChild(td2);
  trow.appendChild(td3);
  trow.appendChild(td4);
  trow.appendChild(td5);

  var ControlDiv = document.createElement('div');
  ControlDiv.innerHTML = '<span class="fa-solid fa-file-pen actions" style="color: #0B6623;" data-bs-toggle="modal" data-toggle="tooltip" title="Update" data-bs-target="#staticBackdrop1" onclick="FillTboxes(' + dataNo + ',\'' + id + '\')"></span>';
  ControlDiv.innerHTML += '<span class="fa-solid fa-file-circle-xmark actions" style="color:#7C0A02;" data-toggle="modal" data-toggle="tooltip" title="Delete" data-bs-target="#deleteModal"  onclick="DelButt(\'' + id + '\')"></span>';

  trow.appendChild(ControlDiv);
  tbody.appendChild(trow);

}


function populateTableList(UserDocList){
  dataNo=0;
  tbody.innerHTML="";
  UserDocList.forEach(element => {
    AddItemToTable(element.country, element.who_reg, element.cases, element.death, element.id);

  })
}


function GetAllDataRealtime(){
  const q = query(collection(db, "covid"))
  const list = onSnapshot(q, (querySnapshot) => {
     var datasetss = [];

    querySnapshot.forEach(doc => {
      const data = doc.data();
      datasetss.push({...data, id: doc.id}); 
      console.log(doc.id)
    })
    datasetss.sort((a, b) => (a.country > b.country) ? 1 : -1);
    populateTableList(datasetss)
  })
}

window.onload = GetAllDataRealtime;


//------------------------------------Edit Data------------------------------------------//

var edCountry = document.getElementById('countryEd');
var edReg = document.getElementById('regEd');
var edCase = document.getElementById('caseEd');
var edDeath = document.getElementById('deathEd');
var EditBtn = document.querySelector("#edButton");

window.FillTboxes = function(id, docId) {
  --id;
  edCountry.value = datasets[id][0];
  edReg.value = datasets[id][1];
  edCase.value = datasets[id][2];
  edDeath.value = datasets[id][3];
  EditBtn.dataset.id = docId;
};

const saveEdit = document.querySelector("#edButton")
saveEdit.addEventListener("click", async () =>{
  try {
    const docRef = doc(db, "covid", EditBtn.dataset.id);
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
      await setDoc(docRef, {
        country: edCountry.value,
        who_reg: edReg.value,
        cases: edCase.value,
        death: edDeath.value,

      });
    }
    const editDataModal = document.getElementById('staticBackdrop1');
    const modal = bootstrap.Modal.getInstance(editDataModal);
    modal.hide();
  } catch (error) {
    console.log(error)
  }
});

//------------------------------------Delete Data------------------------------------------//

//------------------------------------------------OG Delete Button
window.DelButt = async function(id) {
  const docRef = doc(db, "covid", id);
  const docSnap = await getDoc(docRef);
  if (docSnap.exists()) {
    await deleteDoc(docRef);
    setData(data.filter((item)=> item.id !==id));
    console.log(doc.id)
  } else {
    console.log("Document does not exist");
  }
}

</script>